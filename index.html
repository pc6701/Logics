<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>K-Map Solver</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { 
      position: relative; 
      background: #f8f9fa; 
      padding-top: 70px;
    }
    section { 
      padding-top: 70px; 
      padding-bottom: 40px; 
    }
    .kmap-cell {
      width: 60px; height: 60px;
      text-align: center; vertical-align: middle;
      border: 1px solid #444;
      font-weight: bold;
      font-size: 18px;
    }
    .table th, .table td { text-align: center; }
    .navbar-brand { font-weight: bold; }
    .card { border-radius: 15px; }
    h4 { color: #0d6efd; }
  </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#navbar" data-bs-smooth-scroll="true" tabindex="0">

<!-- Navbar -->
<nav id="navbar" class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">üßÆ K-Map Solver</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#exprSection">Boolean Expression</a></li>
        <li class="nav-item"><a class="nav-link" href="#canonSection">Canonical Form</a></li>
        <li class="nav-item"><a class="nav-link" href="#truthTable">Truth Table</a></li>
        <li class="nav-item"><a class="nav-link" href="#kmap">K-Map</a></li>
        <li class="nav-item"><a class="nav-link" href="#results">Results</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">

  <!-- Boolean Expression Input -->
  <section id="exprSection" class="card p-4 shadow-sm">
    <h4>Boolean Expression Input</h4>
    <p class="text-muted">Example: <code>A'B + (C+D)'</code></p>
    <div class="row g-2">
      <div class="col-md-8">
        <input type="text" id="exprInput" class="form-control" placeholder="Enter Boolean Expression" />
      </div>
      <div class="col-md-4">
        <select id="varCountExpr" class="form-select">
          <option value="2">2 Variables</option>
          <option value="3">3 Variables</option>
          <option value="4" selected>4 Variables</option>
        </select>
      </div>
    </div>
    <button id="solveExpr" class="btn btn-primary mt-3">üîç Solve Expression</button>
  </section>

  <!-- Canonical Input -->
  <section id="canonSection" class="card p-4 shadow-sm mt-4">
    <h4>Canonical Form Input</h4>
    <p class="text-muted">
      Examples: <code>Œ£m(0,1,2,3,5)</code>, <code>œÄM(0,2,7)</code>
    </p>
    <div class="row g-2">
      <div class="col-md-8">
        <input type="text" id="canonInput" class="form-control" placeholder="Enter Œ£/œÄ Form" />
      </div>
      <div class="col-md-4">
        <select id="varCountCanon" class="form-select">
          <option value="2">2 Variables</option>
          <option value="3">3 Variables</option>
          <option value="4" selected>4 Variables</option>
        </select>
      </div>
    </div>
    <button id="solveCanon" class="btn btn-success mt-3">üìò Solve Canonical</button>
  </section>

  <!-- Truth Table -->
  <section id="truthTable" class="card p-4 shadow-sm d-none mt-4">
    <h4>Truth Table</h4>
    <div id="tableOutput"></div>
  </section>

  <!-- K-map -->
  <section id="kmap" class="card p-4 shadow-sm d-none mt-4">
    <h4>K-Map</h4>
    <div id="kmapOutput" class="table-responsive"></div>
  </section>

  <!-- Results -->
  <section id="results" class="card p-4 shadow-sm d-none mt-4">
    <h4>Results</h4>
    <p><strong>Minimal SOP:</strong> <span id="minSop"></span></p>
    <p><strong>Minimal POS:</strong> <span id="minPos"></span></p>
  </section>
</div>

<script>
// --- Boolean Expression Parser ---
function booleanToJS(expr, context, vars) {
  let jsExpr = expr;
  vars.forEach(v=>{
    jsExpr = jsExpr.replace(new RegExp(v+"'", "g"), "!("+context[v]+")");
  });
  vars.forEach(v=>{
    jsExpr = jsExpr.replace(new RegExp(v,"g"), context[v]);
  });
  jsExpr = jsExpr.replace(/\(([^\(\)]+)\)'/g, "(!($1))");
  jsExpr = jsExpr.replace(/\+/g,"||");
  jsExpr = jsExpr.replace(/([01\)])([01\(!])/g,"$1&&$2");
  return jsExpr;
}

// --- Generate Outputs ---
function generateOutputs(expr, vars, mode="expr") {
  let outputs=[];
  let rows=Math.pow(2,vars.length);

  if (mode==="canon") {
    let isSOP = expr[0].toUpperCase()==="Œ£";
    let inside = expr.match(/\(([^)]+)\)/);
    let indices = inside ? inside[1].split(",").map(x=>parseInt(x.trim())) : [];
    for (let i=0;i<rows;i++) {
      let bits=i.toString(2).padStart(vars.length,"0").split("").map(x=>+x);
      let context={};
      vars.forEach((v,j)=>context[v]=bits[j]);
      let result=isSOP? (indices.includes(i)?1:0) : (indices.includes(i)?0:1);
      outputs.push({...context,result});
    }
    return outputs;
  }

  for (let i=0;i<rows;i++) {
    let bits=i.toString(2).padStart(vars.length,"0").split("").map(x=>+x);
    let context={};
    vars.forEach((v,j)=>context[v]=bits[j]);
    let jsExpr = booleanToJS(expr,context,vars);
    let result=eval(jsExpr)?1:0;
    outputs.push({...context,result});
  }
  return outputs;
}

// --- Draw Truth Table ---
function drawTruthTable(vars, outputs) {
  let html="<table class='table table-bordered table-striped'><thead class='table-dark'><tr>";
  vars.forEach(v=>html+=`<th>${v}</th>`);
  html+="<th>F</th></tr></thead><tbody>";
  outputs.forEach(o=>{
    html+="<tr>";
    vars.forEach(v=>html+=`<td>${o[v]}</td>`);
    html+=`<td>${o.result}</td></tr>`;
  });
  html+="</tbody></table>";
  document.getElementById("tableOutput").innerHTML=html;
}

// --- Simplify ---
function simplifyKmap(outputs, vars, formType) {
  let terms = (formType==="SOP") ? outputs.filter(o=>o.result===1) : outputs.filter(o=>o.result===0);
  if (terms.length===0) return formType==="SOP"?"0":"1";
  if (terms.length===Math.pow(2,vars.length)) return formType==="SOP"?"1":"0";
  let solution="";
  if (formType==="SOP") {
    solution=terms.map(o=>vars.map(v=>o[v]?v:v+"'").join("")).join(" + ");
  } else {
    solution=terms.map(o=>"("+vars.map(v=>o[v]? v+"'":v).join(" + ")+")").join(" ");
  }
  return solution;
}

// --- Draw K-map ---
function drawKmap(vars, outputs) {
  let size=vars.length;
  let rows=(size<=2)?2:(size===3?2:4);
  let cols=(size===2)?2:(size===3?4:4);
  let gray=["00","01","11","10"];
  let html="<table class='table table-bordered w-auto'>";
  html+="<tr><th></th>";
  for(let c=0;c<cols;c++) html+=`<th>${gray[c].slice(-(size>2?2:1))}</th>`;
  html+="</tr>";
  for(let r=0;r<rows;r++){
    html+=`<tr><th>${gray[r].slice(0,(size>2?size-2:1))}</th>`;
    for(let c=0;c<cols;c++){
      let idx;
      if(size===2){ idx=parseInt(gray[r]+gray[c],2); }
      else if(size===3){ idx=parseInt(gray[r]+gray[c].slice(1),2); }
      else { idx=parseInt(gray[r]+gray[c],2); }
      html+=`<td class='kmap-cell'>${outputs[idx].result}</td>`;
    }
    html+="</tr>";
  }
  html+="</table>";
  document.getElementById("kmapOutput").innerHTML=html;
}

// --- Solve Helper ---
function solve(expr,vars,mode){
  let outputs=generateOutputs(expr,vars,mode);
  drawTruthTable(vars,outputs);
  drawKmap(vars,outputs);
  document.getElementById("truthTable").classList.remove("d-none");
  document.getElementById("kmap").classList.remove("d-none");
  document.getElementById("results").classList.remove("d-none");
  document.getElementById("minSop").textContent=simplifyKmap(outputs,vars,"SOP");
  document.getElementById("minPos").textContent=simplifyKmap(outputs,vars,"POS");
}

// --- Button Handlers ---
document.getElementById("solveExpr").addEventListener("click",()=>{
  let expr=document.getElementById("exprInput").value.trim();
  let varCount=+document.getElementById("varCountExpr").value;
  let vars=["A","B","C","D"].slice(0,varCount);
  solve(expr,vars,"expr");
});

document.getElementById("solveCanon").addEventListener("click",()=>{
  let expr=document.getElementById("canonInput").value.trim();
  let varCount=+document.getElementById("varCountCanon").value;
  let vars=["A","B","C","D"].slice(0,varCount);
  solve(expr,vars,"canon");
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 